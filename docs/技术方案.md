
# MCP-Gateway 技术方案

## 1. 系统架构

```
+------------------+        +------------------+        +------------------+
|                  |        |                  |        |                  |
|   前端应用       |<------>|   MCP-Gateway    |<------>|  外部数据源      |
|   Vue3+Tailwind  |   HTTP |   Gin(Go)        |  HTTP  |  (DB/REST API)   |
|                  |        |                  |        |                  |
+------------------+        +------------------+        +------------------+
                                     |
                                     v
                            +------------------+
                            |                  |
                            |  Wasm Runtime    |
                            |  (MCP Server)    |
                            |                  |
                            +------------------+
```

## 2. 核心模块设计

### 2.1 HTTP接口管理模块

- **数据模型**：接口定义、参数格式、返回格式、版本信息
- **功能**：
  - CRUD操作接口配置
  - OpenAPI导出功能
  - YAML格式导出(MCP-server配置)
  - 版本历史管理和回滚

### 2.2 MCP-Server管理模块

- **数据模型**：服务名称、工具列表、服务配置、版本信息
- **功能**：
  - MCP-Server元信息管理
  - HTTP结构到MCP-Server映射
  - Wasm编译和动态加载
  - 发布和版本管理

### 2.3 路由管理模块

- **数据模型**：路由规则、目标服务、路由配置
- **功能**：
  - 路由规则配置
  - 动态路由匹配
  - 路由转发和负载均衡

## 3. 技术实现

### 3.1 后端架构

```
/
├── cmd/                 # 入口程序
├── pkg/                 # 公共包
│   ├── models/          # 数据模型
│   ├── config/          # 配置管理
│   └── utils/           # 工具函数
├── internal/            # 内部实现
│   ├── api/             # HTTP API实现
│   ├── service/         # 业务逻辑
│   ├── repository/      # 数据存取
│   └── middleware/      # 中间件
├── pkg/http/            # HTTP接口管理
├── pkg/mcp/             # MCP-Server管理
│   ├── compiler/        # Wasm编译
│   ├── runtime/         # Wasm运行时
│   └── templates/       # 响应模板
└── pkg/router/          # 路由管理
```

### 3.2 前端架构

```
/
├── src/
│   ├── assets/          # 静态资源
│   ├── components/      # 通用组件
│   ├── views/           # 页面视图
│   │   ├── http/        # HTTP接口管理
│   │   ├── mcp/         # MCP-Server管理
│   │   └── router/      # 路由管理
│   ├── api/             # API请求
│   ├── store/           # 状态管理
│   ├── router/          # 前端路由
│   └── utils/           # 工具函数
└── public/              # 公共资源
```

## 4. 数据流程

1. **HTTP接口配置**：
   - 用户定义HTTP接口 → 保存到数据库 → 导出为OpenAPI/YAML

2. **MCP-Server发布**：
   - 选择HTTP接口 → 生成MCP-Server配置 → 编译为Wasm → 动态加载到系统

3. **请求处理**：
   - 客户端请求 → 路由匹配 → 转发到对应MCP-Server → 处理请求 → 返回响应

## 5. 核心技术难点及解决方案

1. **Wasm动态加载**：
   - 使用Go-Wasm编译器和运行时
   - 实现热加载和卸载机制

2. **模板渲染**：
   - 集成gjson_template库
   - 支持复杂数据转换和格式化

3. **版本管理和回滚**：
   - 实现乐观锁和版本差异比较
   - 增量更新和全量回滚机制
 